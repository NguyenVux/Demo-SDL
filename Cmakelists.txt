cmake_minimum_required(VERSION 3.30)
project(DemoSDL)
# Generate compile commands.json for better IDE support
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

set(CMAKE_CXX_STANDARD 20)


add_subdirectory(${CMAKE_SOURCE_DIR}/box2d)
add_executable(DemoSDL 
    "${CMAKE_SOURCE_DIR}/src/main.cpp"
    "${CMAKE_SOURCE_DIR}/src/FSM.cpp"
    "${CMAKE_SOURCE_DIR}/src/FSM.h"
    "${CMAKE_SOURCE_DIR}/src/IState.h"
    "${CMAKE_SOURCE_DIR}/src/Application.cpp"
    "${CMAKE_SOURCE_DIR}/src/Application.h"
    "${CMAKE_SOURCE_DIR}/src/DebugLayer.cpp"
    "${CMAKE_SOURCE_DIR}/src/DebugLayer.h"
    "${CMAKE_SOURCE_DIR}/src/ILayer.h"
    "${CMAKE_SOURCE_DIR}/src/LayerStack.cpp"
    "${CMAKE_SOURCE_DIR}/src/LayerStack.h"
    "${CMAKE_SOURCE_DIR}/src/MainGameLayer.cpp"
    "${CMAKE_SOURCE_DIR}/src/MainGameLayer.h"
    "${CMAKE_SOURCE_DIR}/src/Time.h"
    "${CMAKE_SOURCE_DIR}/src/Time.cpp"
    "${CMAKE_SOURCE_DIR}/src/Animation.h"
    "${CMAKE_SOURCE_DIR}/src/Animation.cpp"
    "${CMAKE_SOURCE_DIR}/src/AssetsManager.h"
    "${CMAKE_SOURCE_DIR}/src/AssetsManager.cpp"
)
target_link_libraries(DemoSDL PRIVATE box2d::box2d)
target_precompile_headers(DemoSDL PRIVATE "${CMAKE_SOURCE_DIR}/src/pch.h")
# Add SDL2 for Emscripten
if(EMSCRIPTEN)
    set_target_properties(DemoSDL PROPERTIES SUFFIX ".html")
    target_compile_options(DemoSDL PRIVATE 
        --use-port=sdl2
        --use-port=sdl2_image:formats=png
    )
    target_link_options(DemoSDL PRIVATE 
        --use-port=sdl2
        --use-port=sdl2_image:formats=png
        -sWASM=1 
        -sALLOW_MEMORY_GROWTH=1
        -sFULL_ES2=1
        -sUSE_WEBGL2=1
        --shell-file "${CMAKE_SOURCE_DIR}/dist/index.html"
        --preload-file ${CMAKE_SOURCE_DIR}/assets/@assets/
        --use-preload-plugins
    )
endif()